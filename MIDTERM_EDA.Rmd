---
title: "Midterm EDA: Group 3"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
# knitr::opts_chunk$set(warning = F, results = "hide", message = F)
# knitr::opts_chunk$set(include = F)
# knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```
From 2015- 2022, in response to a deep lack of reporting within government sources, The Washington Post compiled a database of every fatal police shooting in the United States.We are interested in exploring this data, specifically as it shows the differences between US States.

### Setting the Data Up

First we call our packages: dplyr and ggplot2 as well as reading our data:

```{r}
#Calling Packages
library(dplyr)

library(ggplot2)

fp1<- data.frame(read.csv("FPS22.csv"))
```
Then we remove the null values from our dataset
```{r}
#Cleaning null values from dataset
fp <- na.omit(fp1) # Method 1 - Remove NA


```

After Accounting for Null Values: The dataset we are working with has 6574 observations. There is a sample row of the data as well
```{r}
#Getting row count and latest incident
print("Number of observations:") 
nrow(fp)
head(fp, 1)
```
### Basic Stats
He are some basic stats:
```{r}
#test stats
str(fp)

mean(fp$age, na.rm= TRUE)
median(fp$age)


```
```{r}
#First 7 names Printed 
count=1
for (i in fp$name){
  if (i== "Brock Nichols"){
    break}
  else {
    print (i)}
    print(count)
    count= count+1
} 

```
```{r}
#Initial Creation of Regional Subgroups and tests that they cover everything. DO NOT MODIFY. THIS WAS SUPER HARD TO MAKE.
NW <- subset(fp, state=="CA"| state=="WA" | state=="OR" | state== "NV"| state=="ID"| state=="UT"|state=="MT"|state=="CO"| state=="WY"| state=="AK")
nrow(NW)
SW <- subset(fp, state== "NM"| state=="AZ"| state== "TX"| state=="OK"| state== "HI")
nrow(SW)
MW <- subset(fp, state== "IL"| state=="WI"| state=="IN"| state=="MI"| state== "MN"| state== "MO"| state== "IA"| state=="KS"| state=="ND"| state== "SD"| state=="NE"| state=="OH")
nrow(MW)
SE <- subset(fp, state == "GA"| state=="AL"| state== "MS"| state=="LA"| state=="TN"| state=="NC"| state=="SC"| state=="FL"| state== "AR"|state=="WV"| state=="DC"| state=="VA"| state=="KY"| state=="DE")
nrow(SE)
NE <- subset(fp, state=="NY"| state== "MD"| state=="RI"| state== "VT"| state=="PA"| state=="ME"| state== "NH"| state=="NJ"| state=="CT"| state=="MA")
nrow(NE)

(nrow(NE)+nrow(SE) +nrow(MW) +nrow(SW) + nrow(NW))
nrow(fp)
```
```{r}
table(fp$race)
```


```{r}
#Implementation of the subgroups as a new factor called "regions". PLEASE PLEASE DO NOT MODIFY. THIS TOOK FOREVER
fp$regions <- as.factor(ifelse(( fp$state=="CA"| fp$state=="WA" | fp$state=="OR" | fp$state== "NV"| fp$state=="ID"| fp$state=="UT"|fp$state=="MT"|fp$state=="CO"| fp$state=="WY"| fp$state=="AK"), 'NW',
                     ifelse((fp$state== "NM"| fp$state=="AZ"| fp$state== "TX"| fp$state=="OK"| fp$state== "HI"), 'SW', 
                     ifelse((fp$state== "IL"| fp$state=="WI"| fp$state=="IN"| fp$state=="MI"| fp$state== "MN"| fp$state== "MO"| fp$state== "IA"| fp$state=="KS"| fp$state=="ND"| fp$state== "SD"| fp$state=="NE"| fp$state=="OH"), 'MW', 
                     ifelse(( fp$state=="NY"| fp$state== "MD"| fp$state=="RI"| fp$state== "VT"| fp$state=="PA"| fp$state=="ME"| fp$state== "NH"| fp$state=="NJ"| fp$state=="CT"| fp$state=="MA"), 'NE', 'SE')))))

```


```{r}
#Defining 2 new datasets. These show all the variables (with some modification) by state. PLEASE DO NOT MODIFY. THIS WAS HARD AS HELL.
#Still working on it

sfp <- fp %>%
   group_by(state) %>%
   mutate(stbcp =  sum(body_camera==1)/n())
#This is a numeric proportion of the Men by state
sfp <- sfp %>%
   group_by(state) %>%
   mutate(gen.p =  sum(gender=="M")/n())
#This is a numeric proportion of sings_of_mental_illness by state
sfp <- sfp %>%
   group_by(state) %>%
   mutate(smi.p =  sum(signs_of_mental_illness==TRUE)/n())
#This is a numeric proportion of fleeing victims by state
sfp <- sfp %>%
   group_by(state) %>%
   mutate(flee.p =  sum(flee=="fleeing")/n())
#This is a numeric proportion of attackers by state
sfp <- sfp %>%
   group_by(state) %>%
   mutate(att.p =  sum(threat_level== "attack")/n())
#This is a numeric proportion of armed victims by state
sfp <- sfp %>%
   group_by(state) %>%
   mutate(armed.p =  sum(armed != "unarmed")/n())
#This is a numeric proportion of suspects being shot (as opposed to tasered) by state
sfp <- sfp %>%
   group_by(state) %>%
   mutate(MoD.p =  sum(manner_of_death == "shot")/n())
#This is the average age by state
sfp <- sfp %>%
   group_by(state) %>%
   mutate(age.avg =  sum(age)/n())
#This is variable is for later analysis (maybe for the final) and is the proportion of non-white victims by state
sfp <- sfp %>%
   group_by(state) %>%
   mutate(Non_White_prop =  sum(race != "W")/n())

#This line just drops all non grouped by state data from this version of the dataframe
By_State <- subset(sfp, select= -c(name, id, age, latitude, longitude, city, manner_of_death, gender, armed, race, signs_of_mental_illness, flee, threat_level, body_camera, date, is_geocoding_exact))

summary(By_State)
```







```{r}
rfp <- fp %>%
   group_by(regions) %>%
   mutate(rgbcp =  sum(body_camera==TRUE)/n())

rfp <- sfp %>%
   group_by(regions) %>%
   mutate(gen.p =  sum(gender=="M")/n())

rfp <- sfp %>%
   group_by(regions) %>%
   mutate(smi.p =  sum(signs_of_mental_illness==TRUE)/n())

rfp <- rfp %>%
   group_by(regions) %>%
   mutate(flee.p =  sum(flee=="fleeing")/n())

rfp <- sfp %>%
   group_by(regions) %>%
   mutate(att.p =  sum(threat_level== "attack")/n())
rfp <- sfp %>%
   group_by(regions) %>%
   mutate(armed.p =  sum(armed != "unarmed")/n())
rfp <- sfp %>%
   group_by(regions) %>%
   mutate(MoD.p =  sum(manner_of_death == "shot")/n())
rfp <- sfp %>%
   group_by(regions) %>%
   mutate(age.avg =  sum(age)/n())
rfp <- sfp %>%
   group_by(regions) %>%
   mutate(Non_White_prop =  sum(race != "W")/n())



By_Region <- subset(sfp, select= -c(name, id, age, latitude, longitude, city, manner_of_death, gender, armed, race, signs_of_mental_illness, flee, threat_level, body_camera, regions, date, is_geocoding_exact))



summary(By_Region)


```

```{r}
#Just some tests on the new sub dataset
mean(By_State$stbcp)
head(By_State)
```
Explanation:

I made two new datasets. One grouped by State, one grouped by Region.4
```{r}
#a bar graph showing number of fatal police shootings AND proportions of body cameras being on by region (too many states to show on a bar graph like this)
ggplot(fp, aes(x = regions, y = frequency(regions), color=body_camera)) + geom_bar(stat = "identity")+ labs(x = "State", y="Number of Incidents", title = "Regional Police Shootings Colored by Body Camera Proportions")

#Normality check of proportions of body cameras being on by state
qqnorm(By_State$stbcp)
#Seems Normal

```
```{r}
#Scatter Plot of Body Camera Proportion by State
ggplot(By_State, aes(x=state, y= stbcp, label=state)) + geom_point(shape=6, color="violet")+ labs(x = "State", y="Body Camera Proportion", title = "Body Camera On Proportion By US State") + geom_text(hjust=1, vjust=-0.6)

#This is kind of a mess so lets try grouping by regions on the next graph
#ggplot(By_Region, aes(x=regions, y= rgbcp, label=regions)) + geom_point(shape=8, color="navy")+ labs(x = "Region", y="Body Camera Proportion", title = "Body Camera On Proportion #By US Region") +  geom_text(hjust=1, vjust=-0.6)
```




```{r}
summary(By_State)

```

```{r}
#Some statistical testing that I need to tinker more with next week


```


```{r}

itwo.way <- aov(stbcp ~ ((age.avg * Non_White_prop * gen.p) + (smi.p * flee.p * MoD.p * att.p * armed.p)), data=sfp)
summary(itwo.way) 
```
```{r}

```

```{r}
# Use sfp to call dataset grouped by states, call rfp dataset grouped by regions, and fp

mean(rfp$rgbcp)

```

```{r}
head(By_State)

```

```{r}
test<- By_State

cat3 <- test %>% mutate(proportion=cut(stbcp, breaks=c(0, 0.10, 0.2, 0.3, Inf),labels = c("low", "medium", "high", "very high")))

summary(cat3$stbcp)
cat3$state <- as.factor(cat3$state)
cat3$stbcp <- as.factor(cat3$stbcp)

contable= table(cat3$state, cat3$stbcp)
#print(contable)

chisq.test(contable)

```

